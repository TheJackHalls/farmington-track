---
import importPanelScript from "../scripts/importPanelClient.ts?url";

const { panelId = "track-import" } = Astro.props;
---

<aside
  class="rounded-lg border border-slate-200 bg-white p-4 shadow-sm"
  data-track-import-panel={panelId}
>
  <div class="space-y-2">
    <h2 class="text-lg font-semibold text-slate-900">Import meet results</h2>
    <p class="text-sm text-slate-600">
      Upload a CSV export from Athletic.net or MeetTrax to replace the demo data.
      We store it locally in your browser.
    </p>
  </div>

  <form class="mt-4 space-y-3" data-import-form>
    <label class="block text-sm font-medium text-slate-700">
      CSV file
      <input
        class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm"
        type="file"
        accept=".csv,text/csv"
        required
      />
    </label>

    <div class="grid gap-3 sm:grid-cols-2">
      <label class="block text-sm font-medium text-slate-700">
        Meet name
        <input
          class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm"
          type="text"
          name="meetName"
          placeholder="e.g. District Championships"
          required
        />
      </label>
      <label class="block text-sm font-medium text-slate-700">
        Meet date
        <input
          class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm"
          type="date"
          name="meetDate"
        />
      </label>
    </div>

    <div class="grid gap-3 sm:grid-cols-2">
      <label class="block text-sm font-medium text-slate-700">
        Season
        <input
          class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm"
          type="text"
          name="meetSeason"
          placeholder="e.g. 2025 Outdoor"
        />
      </label>
      <label class="block text-sm font-medium text-slate-700">
        Location
        <input
          class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm"
          type="text"
          name="meetLocation"
          placeholder="e.g. Farmington, UT"
        />
      </label>
    </div>

    <label class="block text-sm font-medium text-slate-700">
      Source
      <select
        class="mt-1 w-full rounded-md border border-slate-300 bg-white px-3 py-2 text-sm"
        name="meetSource"
      >
        <option value="Athletic.net">Athletic.net</option>
        <option value="MeetTrax">MeetTrax</option>
      </select>
    </label>

    <div class="flex flex-wrap gap-2">
      <button
        class="rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700"
        type="submit"
        data-import-submit
      >
        Import CSV
      </button>
      <button
        class="rounded-md border border-slate-300 px-4 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50"
        type="button"
        data-import-clear
      >
        Clear imports
      </button>
    </div>
  </form>

  <div class="mt-4 space-y-2 text-sm">
    <p class="text-slate-600" data-import-status>Waiting for a CSV file.</p>
    <p class="text-slate-600" data-import-summary>No imports yet.</p>
    <div class="hidden space-y-1" data-import-progress>
      <div class="flex items-center justify-between text-xs text-slate-500">
        <span>Uploading CSVâ€¦</span>
        <span data-import-percent>0%</span>
      </div>
      <div class="h-2 w-full overflow-hidden rounded-full bg-slate-200">
        <div
          class="h-full w-0 rounded-full bg-blue-600 transition-[width] duration-150"
          data-import-bar
        ></div>
      </div>
    </div>
    <ul class="list-disc space-y-1 pl-5 text-slate-500" data-import-warnings></ul>
  </div>
</aside>

<script type="module" src={importPanelScript}></script>
